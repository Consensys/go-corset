;; Sign extend given a size -1 of the integer to be sign-extended
;; this function handles sizes up to 31
;; if size == 0, sign is extended to fit a 32 bytes word
;; if size == 31, word stays unchanged

include "byte.zkasm"
include "fill_bytes.zkasm"

fn signextend(size u5, word u256) -> (res u256) {
    var t_byte u8
    var t u5
    t = 31 - size
    t_byte  = byte256(word, t)
    ;; take the most significant bit of t_byte
    var msb u1
    var rest u7
    msb, rest = t_byte
    ;; if msb is 0, then we fill with 0s from 0 to t
    if msb  == 0 goto exit_fill_0
    ;; if msb is 1, then we fill with 1s from 0 to t
    res = fill_bytes_between(word, 0, t, 255)
    return
exit_fill_0:
    res = fill_bytes_between(word, 0, t, 0)
    return
}